{% extends "base.twig" %}

{% block styles %}
<link rel="stylesheet" href="../public/Styles/login.css">
{% endblock %}

{% block content %}
<div class="logg">

  <div class="head2">
    <button class="back" onclick="history.back()">&#8592;</button>
    <h3>Login</h3>
  </div>

  <div id="toast" class="toast"></div>

  <form id="login-form" class="login-page">
    <input type="email" name="email" placeholder="Email" required>
    <input type="password" name="password" placeholder="Password" required>
    <button type="submit">Login</button>
    <p>Don’t have an account? <a href="/register">Register</a></p>
  </form>

</div>

<footer class="footer">
  <div class="footer-content">
    <div class="footer-logo">
      <h2>TechWave</h2>
    </div>
    <div class="footer-links">
      <a href="/">Home</a>
      <a href="/register">Register</a>
      <a href="/login">Login</a>
    </div>
    <div class="footer-socials">
      <a href="https://twitter.com" target="_blank"><i class="fa-brands fa-x-twitter"></i></a>
      <a href="https://linkedin.com" target="_blank"><i class="fa-brands fa-linkedin"></i></a>
      <a href="https://instagram.com" target="_blank"><i class="fa-brands fa-instagram"></i></a>
    </div>
  </div>
  <p class="footer-copy">© 2025 TechWave. All rights reserved.</p>
</footer>

<script>
const form = document.getElementById('login-form');
const toast = document.getElementById('toast');

function showToast(message, type='success') {
  toast.textContent = message;
  toast.className = 'toast ' + type;
  toast.style.display = 'block';
  setTimeout(() => { toast.style.display = 'none'; }, 3000);
}

form.addEventListener('submit', async function(e) {
  e.preventDefault();

  const data = {
    email: form.email.value.trim(),
    password: form.password.value.trim()
  };

  if (!data.email || !data.password) {
    showToast('Email and password are required.', 'error');
    return;
  }

  try {
    const res = await fetch(`https://mockdata-93rw.onrender.com/users`);
    const users = await res.json();

    const found = users.find(u => u.email === data.email && u.password === data.password);

    if (found) {
      localStorage.setItem('user', JSON.stringify(found));
      showToast('Login successful!', 'success');
      setTimeout(() => window.location.href = '/dashboard', 1000);
    } else {
      showToast('Invalid credentials.', 'error');
    }
  } catch (err) {
    showToast('Server error. Try again.', 'error');
  }
});
</script>
{% endblock %}
